<!DOCTYPE HTML>
<html lang="en">
<head></head>
<body>
		
<script src='js/jquery/jquery.min.js'></script>
<script type="text/javascript">
(function($){
	var _priv = {
		cyclicCheck: null,
		
		diff: function(obj1, obj2){
			if (typeof obj1 === 'undefined')	obj1 = {};
			if (typeof obj2 === 'undefined')	obj2 = {};
			
			var val1, val2, mod = {}, add = {}, del = {}, ret;
			jQuery.each(obj2, function(key, val2){
				val1	= obj1[key];
				bDiff	= false;
				if (typeof val1 === 'undefined'){
					add[key] = val2;
				}else if( typeof val1 != typeof val2 ){
					mod[key] = val2;
				}else if( val1 !== val2 ){
					if (typeof val2 === 'object'){
						if (_priv.cyclicCheck.indexOf(val2) >= 0)
							return false; // break the $.each() loop
						ret = _priv.diff(val1, val2);
						if (!$.isEmptyObject(ret.mod))
							mod[key] = $.extend(true, {}, ret.mod);
						if (!$.isEmptyObject(ret.add))
							add[key] = $.extend(true, {}, ret.add);
						if (!$.isEmptyObject(ret.del))
							del[key] = $.extend(true, {}, ret.del);
						_priv.cyclicCheck.push(val2);
					}else{
						mod[key] = val2;
					}
				}
			});
			
			jQuery.each(obj1, function(key, val1){
				if (typeof obj2[key] === 'undefined')
				  del[key] = true;
			});
			
			return {mod: mod, add: add, del: del};
		}
	};
  
	jQuery.diff = function(obj1, obj2){
		_priv.cyclicCheck = [];
		return _priv.diff(obj1, obj2);
	}
})(jQuery);

  
// Author: Michael SchÃ¸ler, 2008
// LGPL license, use as you like, don't hold me responsible for success or failure though
var jsonDataHandler = {
  merge: function(j1, j2) {
    if (typeof this.merging === "undefined" || this.merging === 0) {
      this.mergeCyclicCheck = [];
      this.merging = 0;
    }
    this.merging += 1;
    if (typeof j1 === "undefined") {
      j1 = {};
    }
    if (typeof j2 === "undefined") {
      j2 = {};
    }
    if (typeof this.mergeCyclicCheck === "undefined") {
      this.mergeCyclicCheck = [];
    }
    var key;
    for (key in j2) if (j2.hasOwnProperty(key)) {
      if (typeof j1[key] === "undefined") {
        j1[key] = j2[key];
      }
      else {
        if (typeof j2[key] === "object") {
          if (this.mergeCyclicCheck.indexOf(j1[key]) >= 0) {
            break;
          }
          this.merge(j1[key], j2[key]);
          this.mergeCyclicCheck.push(j1[key]);
        } 
        else {
          j1[key] = j2[key]; 
        }
      }
    }
    this.merging -= 1;
  }
};

</script>
<script>

var JsonDiff	= {};
JsonDiff.diff	= function(jsonOld, jsonNew){
	return jQuery.diff(jsonNew, jsonOld);	

}
JsonDiff.patch	= function(jsonOld, jsonPatch){
	jsonDataHandler.merge(jsonOld, jsonPath.add)
	jsonDataHandler.merge(jsonOld, jsonPath.mod)
	return jsonOld;
}


var jsonOld	= {
	"prout"	: [1],
	"foo"	: "bar"
};
var jsonNew	= {
	"prout"	: [2],
	"slota"	: "sloti"
};
var patch	= JsonDiff.diff(jsonNew, jsonOld);
console.log('jsonOld',  JSON.stringify(jsonOld))
console.log('jsonNew',  JSON.stringify(jsonNew))
console.log('patch', JSON.stringify(patch));
//JsonDiff.patch(jsonOld, patch);
//console.log('wow', jsonOld);
</script>

</body>
</html>